(function(l,O){typeof exports=="object"&&typeof module<"u"?O(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],O):(l=typeof globalThis<"u"?globalThis:l||self,O(l["configcat-vue-ts"]={},l.Vue))})(this,function(l,O){"use strict";var ue=function(t,e){return ue=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},ue(t,e)};function H(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ue(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var P=function(){return P=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},P.apply(this,arguments)};function b(t,e,r,n){function i(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function s(f){try{u(n.next(f))}catch(g){a(g)}}function c(f){try{u(n.throw(f))}catch(g){a(g)}}function u(f){f.done?o(f.value):i(f.value).then(s,c)}u((n=n.apply(t,e||[])).next())})}function S(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(u){return function(f){return c([u,f])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(r=0)),r;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){r.label=u[1];break}if(u[0]===6&&r.label<o[1]){r.label=o[1],o=u;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(u);break}o[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(f){u=[6,f],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Ke(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n}function T(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}typeof SuppressedError=="function"&&SuppressedError;var W;(function(t){t[t.Fetched=0]="Fetched",t[t.NotModified=1]="NotModified",t[t.Errored=2]="Errored"})(W||(W={}));var q=function(){function t(e,r,n,i){this.status=e,this.config=r,this.errorMessage=n,this.errorException=i}return t.success=function(e){return new t(W.Fetched,e)},t.notModified=function(e){return new t(W.NotModified,e)},t.error=function(e,r,n){return new t(W.Errored,e,r??"Unknown error.",n)},t}(),x=function(t){H(e,t);function e(r){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var o=t.call(this,function(a,s){switch(a){case"abort":return"Request was aborted.";case"timeout":var c=s[0];return"Request timed out. Timeout value: "+c+"ms";case"failure":var u=s[0],f="Request failed due to a network or protocol error.";return u?f+" "+(u instanceof Error?u.message:u+""):f}}(r,n))||this;return o.cause=r,o instanceof e||(Object.setPrototypeOf||function(a,s){return a.__proto__=s})(o,e.prototype),o.args=n,o}return e}(Error),k=function(){function t(e,r,n,i){this.configJson=e,this.config=r,this.timestamp=n,this.httpETag=i}return t.equals=function(e,r){return e.httpETag&&r.httpETag?e.httpETag===r.httpETag:e.configJson===r.configJson},t.prototype.with=function(e){return new t(this.configJson,this.config,e,this.httpETag)},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return!this.config},enumerable:!1,configurable:!0}),t.prototype.isExpired=function(e){return this===t.empty||this.timestamp+e<t.generateTimestamp()},t.generateTimestamp=function(){return new Date().getTime()},t.serialize=function(e){var r,n;return e.timestamp+`
`+((r=e.httpETag)!==null&&r!==void 0?r:"")+`
`+((n=e.configJson)!==null&&n!==void 0?n:"")},t.deserialize=function(e){for(var r=Array(2),n=0,i=0;i<r.length;i++){if(n=e.indexOf(`
`,n),n<0)throw new Error("Number of values is fewer than expected.");r[i]=n++}var o=r[0],a=e.substring(0,o),s=parseInt(a);if(isNaN(s))throw new Error("Invalid fetch time: "+a);n=o+1,o=r[1],a=e.substring(n,o);var c=a.length>0?a:void 0;n=o+1,a=e.substring(n);var u,f;if(a.length>0){try{u=new le(JSON.parse(a))}catch{throw new Error("Invalid config JSON content: "+a)}f=a}return new t(f,u,s,c)},t.serializationFormatVersion="v2",t.empty=new t(void 0,void 0,0,void 0),t}(),le=function(){function t(e){this.settings=e.f?Object.fromEntries(Object.entries(e.f).map(function(r){var n=r[0],i=r[1];return[n,new de(i)]})):{},this.preferences=e.p?new Be(e.p):void 0}return t}(),G;(function(t){t[t.No=0]="No",t[t.Should=1]="Should",t[t.Force=2]="Force"})(G||(G={}));var Be=function(){function t(e){this.baseUrl=e.u,this.redirectMode=e.r}return t}();l.SettingType=void 0,function(t){t[t.Boolean=0]="Boolean",t[t.String=1]="String",t[t.Int=2]="Int",t[t.Double=3]="Double"}(l.SettingType||(l.SettingType={}));var de=function(){function t(e){var r,n,i,o;this.value=e.v,this.type=e.t,this.percentageOptions=(n=(r=e.p)===null||r===void 0?void 0:r.map(function(a){return new ze(a)}))!==null&&n!==void 0?n:[],this.targetingRules=(o=(i=e.r)===null||i===void 0?void 0:i.map(function(a){return new _e(a)}))!==null&&o!==void 0?o:[],this.variationId=e.i}return t.fromValue=function(e){return new t({t:-1,v:e})},t}();l.Comparator=void 0,function(t){t[t.In=0]="In",t[t.NotIn=1]="NotIn",t[t.Contains=2]="Contains",t[t.NotContains=3]="NotContains",t[t.SemVerIn=4]="SemVerIn",t[t.SemVerNotIn=5]="SemVerNotIn",t[t.SemVerLessThan=6]="SemVerLessThan",t[t.SemVerLessThanEqual=7]="SemVerLessThanEqual",t[t.SemVerGreaterThan=8]="SemVerGreaterThan",t[t.SemVerGreaterThanEqual=9]="SemVerGreaterThanEqual",t[t.NumberEqual=10]="NumberEqual",t[t.NumberNotEqual=11]="NumberNotEqual",t[t.NumberLessThan=12]="NumberLessThan",t[t.NumberLessThanEqual=13]="NumberLessThanEqual",t[t.NumberGreaterThan=14]="NumberGreaterThan",t[t.NumberGreaterThanEqual=15]="NumberGreaterThanEqual",t[t.SensitiveOneOf=16]="SensitiveOneOf",t[t.SensitiveNotOneOf=17]="SensitiveNotOneOf"}(l.Comparator||(l.Comparator={}));var _e=function(){function t(e){this.order=e.o,this.comparisonAttribute=e.a,this.comparator=e.t,this.comparisonValue=e.c,this.value=e.v,this.variationId=e.i}return t}(),ze=function(){function t(e){this.order=e.o,this.percentage=e.p,this.value=e.v,this.variationId=e.i}return t}(),J=function(){function t(e,r){this.errorMessage=e,this.errorException=r}return Object.defineProperty(t.prototype,"isSuccess",{get:function(){return this.errorMessage===null},enumerable:!1,configurable:!0}),t.from=function(e){return e.status!==W.Errored?t.success():t.failure(e.errorMessage,e.errorException)},t.success=function(){return new t(null)},t.failure=function(e,r){return new t(e,r)},t}(),A;(function(t){t[t.NoFlagData=0]="NoFlagData",t[t.HasLocalOverrideFlagDataOnly=1]="HasLocalOverrideFlagDataOnly",t[t.HasCachedFlagDataOnly=2]="HasCachedFlagDataOnly",t[t.HasUpToDateFlagData=3]="HasUpToDateFlagData"})(A||(A={}));var w;(function(t){t[t.Online=0]="Online",t[t.Offline=1]="Offline",t[t.Disposed=2]="Disposed"})(w||(w={}));var ce=function(){function t(e,r){this.configFetcher=e,this.options=r,this.pendingFetch=null,this.cacheKey=r.getCacheKey(),this.configFetcher=e,this.options=r,this.status=r.offline?w.Offline:w.Online}return t.prototype.dispose=function(){this.status=w.Disposed},Object.defineProperty(t.prototype,"disposed",{get:function(){return this.status===w.Disposed},enumerable:!1,configurable:!0}),t.prototype.refreshConfigAsync=function(){return b(this,void 0,void 0,function(){var e,r,n,i,o;return S(this,function(a){switch(a.label){case 0:return[4,this.options.cache.get(this.cacheKey)];case 1:return e=a.sent(),this.isOffline?[3,3]:[4,this.refreshConfigCoreAsync(e)];case 2:return r=a.sent(),n=r[0],i=r[1],[2,[J.from(n),i]];case 3:return o=this.options.logger.configServiceCannotInitiateHttpCalls().toString(),[2,[J.failure(o),e]]}})})},t.prototype.refreshConfigCoreAsync=function(e){return b(this,void 0,void 0,function(){var r,n;return S(this,function(i){switch(i.label){case 0:return[4,this.fetchAsync(e)];case 1:return r=i.sent(),n=r.status===W.Fetched,n||r.config.timestamp>e.timestamp&&(!r.config.isEmpty||e.isEmpty)?[4,this.options.cache.set(this.cacheKey,r.config)]:[3,3];case 2:i.sent(),this.onConfigUpdated(r.config),n&&!k.equals(r.config,e)&&this.onConfigChanged(r.config),e=r.config,i.label=3;case 3:return[2,[r,e]]}})})},t.prototype.onConfigUpdated=function(e){},t.prototype.onConfigChanged=function(e){var r;this.options.logger.debug("config changed"),this.options.hooks.emit("configChanged",(r=e.config)!==null&&r!==void 0?r:new le({}))},t.prototype.fetchAsync=function(e){var r=this,n;return(n=this.pendingFetch)!==null&&n!==void 0?n:this.pendingFetch=function(){return b(r,void 0,void 0,function(){return S(this,function(i){switch(i.label){case 0:return i.trys.push([0,,2,3]),[4,this.fetchLogicAsync(e)];case 1:return[2,i.sent()];case 2:return this.pendingFetch=null,[7];case 3:return[2]}})})}()},t.prototype.fetchLogicAsync=function(e){var r;return b(this,void 0,void 0,function(){var n,i,o,a,s,c;return S(this,function(u){switch(u.label){case 0:n=this.options,n.logger.debug("ConfigServiceBase.fetchLogicAsync() - called."),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,this.fetchRequestAsync((r=e.httpETag)!==null&&r!==void 0?r:null)];case 2:switch(o=u.sent(),a=o[0],s=o[1],a.statusCode){case 200:return s?(n.logger.debug("ConfigServiceBase.fetchLogicAsync(): fetch was successful. Returning new config."),[2,q.success(new k(a.body,s,k.generateTimestamp(),a.eTag))]):(i=n.logger.fetchReceived200WithInvalidBody().toString(),n.logger.debug("ConfigServiceBase.fetchLogicAsync(): "+a.statusCode+" "+a.reasonPhrase+" was received but the HTTP response content was invalid. Returning null."),[2,q.error(e,i)]);case 304:return e?(n.logger.debug("ConfigServiceBase.fetchLogicAsync(): content was not modified. Returning last config with updated timestamp."),[2,q.notModified(e.with(k.generateTimestamp()))]):(i=n.logger.fetchReceived304WhenLocalCacheIsEmpty(a.statusCode,a.reasonPhrase).toString(),n.logger.debug("ConfigServiceBase.fetchLogicAsync(): "+a.statusCode+" "+a.reasonPhrase+" was received when no config is cached locally. Returning null."),[2,q.error(e,i)]);case 403:case 404:return i=n.logger.fetchFailedDueToInvalidSdkKey().toString(),n.logger.debug("ConfigServiceBase.fetchLogicAsync(): fetch was unsuccessful. Returning last config (if any) with updated timestamp."),[2,q.error(e.with(k.generateTimestamp()),i)];default:return i=n.logger.fetchFailedDueToUnexpectedHttpResponse(a.statusCode,a.reasonPhrase).toString(),n.logger.debug("ConfigServiceBase.fetchLogicAsync(): fetch was unsuccessful. Returning null."),[2,q.error(e,i)]}return[3,4];case 3:return c=u.sent(),i=(c instanceof x&&c.cause==="timeout"?n.logger.fetchFailedDueToRequestTimeout(c.args[0],c):n.logger.fetchFailedDueToUnexpectedError(c)).toString(),n.logger.debug("ConfigServiceBase.fetchLogicAsync(): fetch was unsuccessful. Returning null."),[2,q.error(e,i,c)];case 4:return[2]}})})},t.prototype.fetchRequestAsync=function(e,r){return r===void 0&&(r=2),b(this,void 0,void 0,function(){var n,i,o,a,s,c,u;return S(this,function(f){switch(f.label){case 0:n=this.options,n.logger.debug("ConfigServiceBase.fetchRequestAsync() - called."),i=0,f.label=1;case 1:return n.logger.debug("ConfigServiceBase.fetchRequestAsync(): calling fetchLogic()"+(i>0?", retry "+i+"/"+r:"")),[4,this.configFetcher.fetchLogic(n,e)];case 2:if(o=f.sent(),o.statusCode!==200)return[2,[o]];if(!o.body)return n.logger.debug("ConfigServiceBase.fetchRequestAsync(): no response body."),[2,[o]];a=void 0;try{a=new le(JSON.parse(o.body))}catch{return n.logger.debug("ConfigServiceBase.fetchRequestAsync(): invalid response body."),[2,[o]]}if(s=a.preferences,!s)return n.logger.debug("ConfigServiceBase.fetchRequestAsync(): preferences is empty."),[2,[o,a]];if(c=s.baseUrl,!c||c===n.baseUrl)return n.logger.debug("ConfigServiceBase.fetchRequestAsync(): baseUrl OK."),[2,[o,a]];if(u=s.redirectMode,n.baseUrlOverriden&&u!==G.Force)return n.logger.debug("ConfigServiceBase.fetchRequestAsync(): options.baseUrlOverriden && redirect !== 2."),[2,[o,a]];if(n.baseUrl=c,u===G.No)return[2,[o,a]];if(u===G.Should&&n.logger.dataGovernanceIsOutOfSync(),i>=r)return n.logger.fetchFailedDueToRedirectLoop(),[2,[o,a]];f.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},Object.defineProperty(t.prototype,"isOfflineExactly",{get:function(){return this.status===w.Offline},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isOffline",{get:function(){return this.status!==w.Online},enumerable:!1,configurable:!0}),t.prototype.setOnlineCore=function(){},t.prototype.setOnline=function(){this.status===w.Offline?(this.setOnlineCore(),this.status=w.Online,this.options.logger.configServiceStatusChanged(w[this.status])):this.disposed&&this.options.logger.configServiceMethodHasNoEffectDueToDisposedClient("setOnline")},t.prototype.setOfflineCore=function(){},t.prototype.setOffline=function(){this.status===w.Online?(this.setOfflineCore(),this.status=w.Offline,this.options.logger.configServiceStatusChanged(w[this.status])):this.disposed&&this.options.logger.configServiceMethodHasNoEffectDueToDisposedClient("setOffline")},t.prototype.onCacheSynced=function(e){this.options.hooks.emit("clientReady",this.getCacheState(e))},t.prototype.syncUpWithCache=function(){return b(this,void 0,void 0,function(){var e;return S(this,function(r){switch(r.label){case 0:return[4,this.options.cache.get(this.cacheKey)];case 1:return e=r.sent(),this.onCacheSynced(e),[2,e]}})})},t}();function Ge(t,e){var r,n=new Promise(function(i){return r=setTimeout(i,t)});return e&&(e.clearTimer=function(){return clearTimeout(r)}),n}function K(t,e){return e===void 0&&(e=!1),t instanceof Error?e&&t.stack?t.stack:t.toString():t+""}function Je(t){var e;return typeof((e=t)===null||e===void 0?void 0:e.then)=="function"}var Ye=function(t){H(e,t);function e(r,n){var i=t.call(this,r,n)||this;i.signalInitialization=function(){},i.pollIntervalMs=n.pollIntervalSeconds*1e3;var o=t.prototype.syncUpWithCache.call(i);return n.maxInitWaitTimeSeconds!==0?(i.initialized=!1,i.initialization=new Promise(function(a){return i.signalInitialization=function(){i.initialized=!0,clearTimeout(i.initTimerId),a()}}),i.initialization.then(function(){return t.prototype.onCacheSynced.call(i,n.cache.getInMemory())}),n.maxInitWaitTimeSeconds>0&&(i.initTimerId=setTimeout(function(){return i.signalInitialization()},n.maxInitWaitTimeSeconds*1e3))):(i.initialized=!0,i.initialization=Promise.resolve(),o.then(function(a){return t.prototype.onCacheSynced.call(i,a)})),n.offline||i.startRefreshWorker(o),i}return e.prototype.onCacheSynced=function(){},e.prototype.waitForInitializationAsync=function(){return b(this,void 0,void 0,function(){var r,n;return S(this,function(i){switch(i.label){case 0:return this.options.maxInitWaitTimeSeconds<0?[4,this.initialization]:[3,2];case 1:return i.sent(),[2,!0];case 2:return r={},[4,Promise.race([this.initialization.then(function(){return!0}),Ge(this.options.maxInitWaitTimeSeconds*1e3,r).then(function(){return!1})])];case 3:return n=i.sent(),r.clearTimer(),[2,n]}})})},e.prototype.getConfig=function(){return b(this,void 0,void 0,function(){function r(i){i.debug("AutoPollConfigService.getConfig() - returning value from cache.")}var n;return S(this,function(i){switch(i.label){case 0:return this.options.logger.debug("AutoPollConfigService.getConfig() called."),!this.isOffline&&!this.initialized?[4,this.options.cache.get(this.cacheKey)]:[3,3];case 1:return n=i.sent(),n.isExpired(this.pollIntervalMs)?(this.options.logger.debug("AutoPollConfigService.getConfig() - cache is empty or expired, waiting for initialization."),[4,this.waitForInitializationAsync()]):(r(this.options.logger),[2,n]);case 2:i.sent(),i.label=3;case 3:return[4,this.options.cache.get(this.cacheKey)];case 4:return n=i.sent(),n.isExpired(this.pollIntervalMs)?this.options.logger.debug("AutoPollConfigService.getConfig() - cache is empty or expired."):r(this.options.logger),[2,n]}})})},e.prototype.refreshConfigAsync=function(){return this.options.logger.debug("AutoPollConfigService.refreshConfigAsync() called."),t.prototype.refreshConfigAsync.call(this)},e.prototype.dispose=function(){this.options.logger.debug("AutoPollConfigService.dispose() called."),t.prototype.dispose.call(this),this.workerTimerId&&this.stopRefreshWorker()},e.prototype.onConfigUpdated=function(r){t.prototype.onConfigUpdated.call(this,r),this.signalInitialization()},e.prototype.setOnlineCore=function(){this.startRefreshWorker()},e.prototype.setOfflineCore=function(){this.stopRefreshWorker()},e.prototype.startRefreshWorker=function(r){return b(this,void 0,void 0,function(){var n,i,o=this;return S(this,function(a){switch(a.label){case 0:return this.options.logger.debug("AutoPollConfigService.startRefreshWorker() called."),n=this.pollIntervalMs,[4,r??this.options.cache.get(this.cacheKey)];case 1:return i=a.sent(),i.isExpired(this.pollIntervalMs)?this.isOfflineExactly?[3,3]:[4,this.refreshConfigCoreAsync(i)]:[3,4];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:this.signalInitialization(),a.label=5;case 5:return this.options.logger.debug("AutoPollConfigService.startRefreshWorker() - calling refreshWorkerLogic()'s setTimeout."),this.workerTimerId=setTimeout(function(s){return o.refreshWorkerLogic(s)},n,n),[2]}})})},e.prototype.stopRefreshWorker=function(){this.options.logger.debug("AutoPollConfigService.stopRefreshWorker() - clearing setTimeout."),clearTimeout(this.workerTimerId)},e.prototype.refreshWorkerLogic=function(r){return b(this,void 0,void 0,function(){var n,i=this;return S(this,function(o){switch(o.label){case 0:return this.disposed?(this.options.logger.debug("AutoPollConfigService.refreshWorkerLogic() - called on a disposed client."),[2]):(this.options.logger.debug("AutoPollConfigService.refreshWorkerLogic() - called."),this.isOffline?[3,3]:[4,this.options.cache.get(this.cacheKey)]);case 1:return n=o.sent(),[4,this.refreshConfigCoreAsync(n)];case 2:o.sent(),o.label=3;case 3:return this.options.logger.debug("AutoPollConfigService.refreshWorkerLogic() - calling refreshWorkerLogic()'s setTimeout."),this.workerTimerId=setTimeout(function(a){return i.refreshWorkerLogic(a)},r,r),[2]}})})},e.prototype.getCacheState=function(r){return r.isEmpty?A.NoFlagData:r.isExpired(this.pollIntervalMs)?A.HasCachedFlagDataOnly:A.HasUpToDateFlagData},e}(ce),$e=function(){function t(){this.cachedConfig=k.empty}return t.prototype.set=function(e,r){this.cachedConfig=r},t.prototype.get=function(e){return this.cachedConfig},t.prototype.getInMemory=function(){return this.cachedConfig},t}(),pe=function(){function t(e,r){this.cache=e,this.logger=r,this.cachedConfig=k.empty}return t.prototype.set=function(e,r){return b(this,void 0,void 0,function(){var n;return S(this,function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!r.isEmpty)this.cachedSerializedConfig=k.serialize(r),this.cachedConfig=r;else return this.cachedSerializedConfig=void 0,this.cachedConfig=r,[2];return[4,this.cache.set(e,this.cachedSerializedConfig)];case 1:return i.sent(),[3,3];case 2:return n=i.sent(),this.logger.configServiceCacheWriteError(n),[3,3];case 3:return[2]}})})},t.prototype.updateCachedConfig=function(e){e==null||e===this.cachedSerializedConfig||(this.cachedConfig=k.deserialize(e),this.cachedSerializedConfig=e)},t.prototype.get=function(e){var r=this;try{var n=this.cache.get(e);if(Je(n))return function(i){return b(r,void 0,void 0,function(){var o,a;return S(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),o=this.updateCachedConfig,[4,i];case 1:return o.apply(this,[s.sent()]),[3,3];case 2:return a=s.sent(),this.logger.configServiceCacheReadError(a),[3,3];case 3:return[2,this.cachedConfig]}})})}(n);this.updateCachedConfig(n)}catch(i){this.logger.configServiceCacheReadError(i)}return Promise.resolve(this.cachedConfig)},t.prototype.getInMemory=function(){return this.cachedConfig},t}();l.LogLevel=void 0,function(t){t[t.Debug=4]="Debug",t[t.Info=3]="Info",t[t.Warn=2]="Warn",t[t.Error=1]="Error",t[t.Off=-1]="Off"}(l.LogLevel||(l.LogLevel={}));var C=function(){function t(e,r,n){this.strings=e,this.argNames=r,this.argValues=n}return t.from=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return function(n){for(var i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];return new t(n,e,i)}},Object.defineProperty(t.prototype,"defaultFormattedMessage",{get:function(){var e=this.cachedDefaultFormattedMessage;if(e===void 0){e="";for(var r=this,n=r.strings,i=r.argValues,o=0;o<n.length-1;o++)e+=n[o],e+=i[o];e+=n[o],this.cachedDefaultFormattedMessage=e}return e},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return this.defaultFormattedMessage},t}(),Xe=function(){function t(e,r){this.logger=e,this.hooks=r}return Object.defineProperty(t.prototype,"level",{get:function(){var e;return(e=this.logger.level)!==null&&e!==void 0?e:l.LogLevel.Warn},enumerable:!1,configurable:!0}),t.prototype.isLogLevelEnabled=function(e){return this.level>=e},t.prototype.log=function(e,r,n,i){var o;return this.isLogLevelEnabled(e)&&this.logger.log(e,r,n,i),e===l.LogLevel.Error&&((o=this.hooks)===null||o===void 0||o.emit("clientError",n.toString(),i)),n},t.prototype.debug=function(e){this.log(l.LogLevel.Debug,0,e)},t.prototype.configJsonIsNotPresent=function(e){return this.log(l.LogLevel.Error,1e3,C.from("DEFAULT_RETURN_VALUE")(ye||(ye=T(["Config JSON is not present. Returning ","."],["Config JSON is not present. Returning ","."])),e))},t.prototype.configJsonIsNotPresentSingle=function(e,r,n){return this.log(l.LogLevel.Error,1e3,C.from("KEY","DEFAULT_PARAM_NAME","DEFAULT_PARAM_VALUE")(Ee||(Ee=T(["Config JSON is not present when evaluating setting '","'. Returning the `","` parameter that you specified in your application: '","'."],["Config JSON is not present when evaluating setting '","'. Returning the \\`","\\` parameter that you specified in your application: '","'."])),e,r,n))},t.prototype.settingEvaluationFailedDueToMissingKey=function(e,r,n,i){return this.log(l.LogLevel.Error,1001,C.from("KEY","DEFAULT_PARAM_NAME","DEFAULT_PARAM_VALUE","AVAILABLE_KEYS")(be||(be=T(["Failed to evaluate setting '","' (the key was not found in config JSON). Returning the `","` parameter that you specified in your application: '","'. Available keys: [","]."],["Failed to evaluate setting '","' (the key was not found in config JSON). Returning the \\`","\\` parameter that you specified in your application: '","'. Available keys: [","]."])),e,r,n,i))},t.prototype.settingEvaluationError=function(e,r,n){return this.log(l.LogLevel.Error,1002,C.from("METHOD_NAME","DEFAULT_RETURN_VALUE")(Se||(Se=T(["Error occurred in the `","` method. Returning ","."],["Error occurred in the \\`","\\` method. Returning ","."])),e,r),n)},t.prototype.settingEvaluationErrorSingle=function(e,r,n,i,o){return this.log(l.LogLevel.Error,1002,C.from("METHOD_NAME","KEY","DEFAULT_PARAM_NAME","DEFAULT_PARAM_VALUE")(Oe||(Oe=T(["Error occurred in the `","` method while evaluating setting '","'. Returning the `","` parameter that you specified in your application: '","'."],["Error occurred in the \\`","\\` method while evaluating setting '","'. Returning the \\`","\\` parameter that you specified in your application: '","'."])),e,r,n,i),o)},t.prototype.forceRefreshError=function(e,r){return this.log(l.LogLevel.Error,1003,C.from("METHOD_NAME")(Ce||(Ce=T(["Error occurred in the `","` method."],["Error occurred in the \\`","\\` method."])),e),r)},t.prototype.fetchFailedDueToInvalidSdkKey=function(){return this.log(l.LogLevel.Error,1100,"Your SDK Key seems to be wrong. You can find the valid SDK Key at https://app.configcat.com/sdkkey")},t.prototype.fetchFailedDueToUnexpectedHttpResponse=function(e,r){return this.log(l.LogLevel.Error,1101,C.from("STATUS_CODE","REASON_PHRASE")(Te||(Te=T(["Unexpected HTTP response was received while trying to fetch config JSON: "," ",""],["Unexpected HTTP response was received while trying to fetch config JSON: "," ",""])),e,r))},t.prototype.fetchFailedDueToRequestTimeout=function(e,r){return this.log(l.LogLevel.Error,1102,C.from("TIMEOUT")(Ae||(Ae=T(["Request timed out while trying to fetch config JSON. Timeout value: ","ms"],["Request timed out while trying to fetch config JSON. Timeout value: ","ms"])),e),r)},t.prototype.fetchFailedDueToUnexpectedError=function(e){return this.log(l.LogLevel.Error,1103,"Unexpected error occurred while trying to fetch config JSON.",e)},t.prototype.fetchFailedDueToRedirectLoop=function(){return this.log(l.LogLevel.Error,1104,"Redirection loop encountered while trying to fetch config JSON. Please contact us at https://configcat.com/support/")},t.prototype.fetchReceived200WithInvalidBody=function(){return this.log(l.LogLevel.Error,1105,"Fetching config JSON was successful but the HTTP response content was invalid.")},t.prototype.fetchReceived304WhenLocalCacheIsEmpty=function(e,r){return this.log(l.LogLevel.Error,1106,C.from("STATUS_CODE","REASON_PHRASE")(Le||(Le=T(["Unexpected HTTP response was received when no config JSON is cached locally: "," ",""],["Unexpected HTTP response was received when no config JSON is cached locally: "," ",""])),e,r))},t.prototype.settingForVariationIdIsNotPresent=function(e){return this.log(l.LogLevel.Error,2011,C.from("VARIATION_ID")(we||(we=T(["Could not find the setting for the specified variation ID: '","'."],["Could not find the setting for the specified variation ID: '","'."])),e))},t.prototype.configServiceCacheReadError=function(e){return this.log(l.LogLevel.Error,2200,"Error occurred while reading the cache.",e)},t.prototype.configServiceCacheWriteError=function(e){return this.log(l.LogLevel.Error,2201,"Error occurred while writing the cache.",e)},t.prototype.clientIsAlreadyCreated=function(e){return this.log(l.LogLevel.Warn,3e3,C.from("SDK_KEY")(Ie||(Ie=T(["There is an existing client instance for the specified SDK Key. No new client instance will be created and the specified options are ignored. Returning the existing client instance. SDK Key: '","'."],["There is an existing client instance for the specified SDK Key. No new client instance will be created and the specified options are ignored. Returning the existing client instance. SDK Key: '","'."])),e))},t.prototype.targetingIsNotPossible=function(e){return this.log(l.LogLevel.Warn,3001,C.from("KEY")(Ne||(Ne=T(["Cannot evaluate targeting rules and % options for setting '","' (User Object is missing). You should pass a User Object to the evaluation methods like `getValueAsync()` in order to make targeting work properly. Read more: https://configcat.com/docs/advanced/user-object/"],["Cannot evaluate targeting rules and % options for setting '","' (User Object is missing). You should pass a User Object to the evaluation methods like \\`getValueAsync()\\` in order to make targeting work properly. Read more: https://configcat.com/docs/advanced/user-object/"])),e))},t.prototype.dataGovernanceIsOutOfSync=function(){return this.log(l.LogLevel.Warn,3002,"The `dataGovernance` parameter specified at the client initialization is not in sync with the preferences on the ConfigCat Dashboard. Read more: https://configcat.com/docs/advanced/data-governance/")},t.prototype.configServiceCannotInitiateHttpCalls=function(){return this.log(l.LogLevel.Warn,3200,"Client is in offline mode, it cannot initiate HTTP calls.")},t.prototype.configServiceMethodHasNoEffectDueToDisposedClient=function(e){return this.log(l.LogLevel.Warn,3201,C.from("METHOD_NAME")(Re||(Re=T(["The client object is already disposed, thus `","()` has no effect."],["The client object is already disposed, thus \\`","()\\` has no effect."])),e))},t.prototype.configServiceMethodHasNoEffectDueToOverrideBehavior=function(e,r){return this.log(l.LogLevel.Warn,3202,C.from("OVERRIDE_BEHAVIOR","METHOD_NAME")(De||(De=T(["Client is configured to use the `","` override behavior, thus `","()` has no effect."],["Client is configured to use the \\`","\\` override behavior, thus \\`","()\\` has no effect."])),e,r))},t.prototype.settingEvaluated=function(e){return this.log(l.LogLevel.Info,5e3,C.from("EVALUATE_LOG")(Fe||(Fe=T(["",""],["",""])),e))},t.prototype.configServiceStatusChanged=function(e){return this.log(l.LogLevel.Info,5200,C.from("MODE")(Pe||(Pe=T(["Switched to "," mode."],["Switched to "," mode."])),e.toUpperCase()))},t}(),me=function(){function t(e){e===void 0&&(e=l.LogLevel.Warn),this.level=e,this.SOURCE="ConfigCat"}return t.prototype.log=function(e,r,n,i){var o=e===l.LogLevel.Debug?[console.info,"DEBUG"]:e===l.LogLevel.Info?[console.info,"INFO"]:e===l.LogLevel.Warn?[console.warn,"WARN"]:e===l.LogLevel.Error?[console.error,"ERROR"]:[console.log,l.LogLevel[e].toUpperCase()],a=o[0],s=o[1],c=i!==void 0?`
`+K(i,!0):"";a(this.SOURCE+" - "+s+" - ["+r+"] "+n+c)},t}(),ye,Ee,be,Se,Oe,Ce,Te,Ae,Le,we,Ie,Ne,Re,De,Fe,Pe;function Y(t){return!!t.fn}var Ze=function(){function t(){this.events={},this.eventCount=0,this.addListener=this.on,this.off=this.removeListener}return t.prototype.addListenerCore=function(e,r,n){if(typeof r!="function")throw new TypeError("Listener must be a function");var i=this.events[e],o={fn:r,once:n};return i?Y(i)?this.events[e]=[i,o]:i.push(o):(this.events[e]=o,this.eventCount++),this},t.prototype.removeListenerCore=function(e,r,n){var i=this.events[e];if(!i)return this;if(Y(i))n(i,r)&&this.removeEvent(e);else for(var o=i.length-1;o>=0;o--)if(n(i[o],r)){i.splice(o,1),i.length?i.length===1&&(this.events[e]=i[0]):this.removeEvent(e);break}return this},t.prototype.removeEvent=function(e){--this.eventCount===0?this.events={}:delete this.events[e]},t.prototype.on=function(e,r){return this.addListenerCore(e,r,!1)},t.prototype.once=function(e,r){return this.addListenerCore(e,r,!0)},t.prototype.removeListener=function(e,r){if(typeof r!="function")throw new TypeError("Listener must be a function");return this.removeListenerCore(e,r,function(n,i){return n.fn===i})},t.prototype.removeAllListeners=function(e){return e?this.events[e]&&this.removeEvent(e):(this.events={},this.eventCount=0),this},t.prototype.listeners=function(e){var r=this.events[e];if(!r)return[];if(Y(r))return[r.fn];for(var n=r.length,i=new Array(n),o=0;o<n;o++)i[o]=r[o].fn;return i},t.prototype.listenerCount=function(e){var r=this.events[e];return r?Y(r)?1:r.length:0},t.prototype.eventNames=function(){var e=[];if(this.eventCount===0)return e;var r=this.events;for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.push(n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(r)):e},t.prototype.emit=function(e,r,n,i,o){var a,s,c=this.events[e];if(!c)return!1;var u,f;Y(c)?(a=[c,1],u=a[0],f=a[1]):(c=c.slice(),s=[c[0],c.length],u=s[0],f=s[1]);for(var g=arguments.length-1,v=0;;){switch(u.once&&this.removeListenerCore(e,u,function(p,E){return p===E}),g){case 0:u.fn.call(this);break;case 1:u.fn.call(this,r);break;case 2:u.fn.call(this,r,n);break;case 3:u.fn.call(this,r,n,i);break;case 4:u.fn.call(this,r,n,i,o);break;default:for(var h=new Array(g),d=0;d<g;d++)h[d]=arguments[d+1];u.fn.apply(this,h);break}if(++v>=f)break;u=c[v]}return!0},t}(),Qe=function(){function t(){this.addListener=this.on,this.off=this.removeListener}return t.prototype.on=function(){return this},t.prototype.once=function(){return this},t.prototype.removeListener=function(){return this},t.prototype.removeAllListeners=function(){return this},t.prototype.listeners=function(){return[]},t.prototype.listenerCount=function(){return 0},t.prototype.eventNames=function(){return[]},t.prototype.emit=function(){return!1},t}(),xe=A,ke=new Qe,et=function(){function t(e){this.addListener=this.on,this.off=this.removeListener,this.eventEmitter=e}return t.prototype.tryDisconnect=function(){var e=this.eventEmitter;return this.eventEmitter=ke,e!==ke},t.prototype.on=function(e,r){return this.eventEmitter.on(e,r),this},t.prototype.once=function(e,r){return this.eventEmitter.once(e,r),this},t.prototype.removeListener=function(e,r){return this.eventEmitter.removeListener(e,r),this},t.prototype.removeAllListeners=function(e){return this.eventEmitter.removeAllListeners(e),this},t.prototype.listeners=function(e){return this.eventEmitter.listeners(e)},t.prototype.listenerCount=function(e){return this.eventEmitter.listenerCount(e)},t.prototype.eventNames=function(){return this.eventEmitter.eventNames()},t.prototype.emit=function(e){for(var r,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return(r=this.eventEmitter).emit.apply(r,Ke([e],n))},t}();function ee(t){function e(V,N){var j=V<<N|V>>>32-N;return j}function r(V){for(var N="",j,R=7;R>=0;R--)j=V>>>R*4&15,N+=j.toString(16);return N}function n(V){V=V.replace(/\r\n/g,`
`);for(var N="",j=0;j<V.length;j++){var R=V.charCodeAt(j);R<128?N+=String.fromCharCode(R):R>127&&R<2048?(N+=String.fromCharCode(R>>6|192),N+=String.fromCharCode(R&63|128)):(N+=String.fromCharCode(R>>12|224),N+=String.fromCharCode(R>>6&63|128),N+=String.fromCharCode(R&63|128))}return N}var i,o,a,s=new Array(80),c=1732584193,u=4023233417,f=2562383102,g=271733878,v=3285377520,h,d,p,E,I,U;t=n(t);var D=t.length,F=new Array;for(o=0;o<D-3;o+=4)a=t.charCodeAt(o)<<24|t.charCodeAt(o+1)<<16|t.charCodeAt(o+2)<<8|t.charCodeAt(o+3),F.push(a);switch(D%4){case 0:o=2147483648;break;case 1:o=t.charCodeAt(D-1)<<24|8388608;break;case 2:o=t.charCodeAt(D-2)<<24|t.charCodeAt(D-1)<<16|32768;break;case 3:o=t.charCodeAt(D-3)<<24|t.charCodeAt(D-2)<<16|t.charCodeAt(D-1)<<8|128;break}for(F.push(o);F.length%16!=14;)F.push(0);for(F.push(D>>>29),F.push(D<<3&4294967295),i=0;i<F.length;i+=16){for(o=0;o<16;o++)s[o]=F[i+o];for(o=16;o<=79;o++)s[o]=e(s[o-3]^s[o-8]^s[o-14]^s[o-16],1);for(h=c,d=u,p=f,E=g,I=v,o=0;o<=19;o++)U=e(h,5)+(d&p|~d&E)+I+s[o]+1518500249&4294967295,I=E,E=p,p=e(d,30),d=h,h=U;for(o=20;o<=39;o++)U=e(h,5)+(d^p^E)+I+s[o]+1859775393&4294967295,I=E,E=p,p=e(d,30),d=h,h=U;for(o=40;o<=59;o++)U=e(h,5)+(d&p|d&E|p&E)+I+s[o]+2400959708&4294967295,I=E,E=p,p=e(d,30),d=h,h=U;for(o=60;o<=79;o++)U=e(h,5)+(d^p^E)+I+s[o]+3395469782&4294967295,I=E,E=p,p=e(d,30),d=h,h=U;c=c+h&4294967295,u=u+d&4294967295,f=f+p&4294967295,g=g+E&4294967295,v=v+I&4294967295}return(r(c)+r(u)+r(f)+r(g)+r(v)).toLowerCase()}l.PollingMode=void 0,function(t){t[t.AutoPoll=0]="AutoPoll",t[t.LazyLoad=1]="LazyLoad",t[t.ManualPoll=2]="ManualPoll"}(l.PollingMode||(l.PollingMode={})),l.DataGovernance=void 0,function(t){t[t.Global=0]="Global",t[t.EuOnly=1]="EuOnly"}(l.DataGovernance||(l.DataGovernance={}));var fe=function(){function t(e,r,n,i,o){var a=this,s,c,u;if(this.requestTimeoutMs=3e4,this.baseUrlOverriden=!1,this.proxy="",this.offline=!1,!e)throw new Error("Invalid 'apiKey' value");switch(this.apiKey=e,this.clientVersion=r,this.dataGovernance=(s=n==null?void 0:n.dataGovernance)!==null&&s!==void 0?s:l.DataGovernance.Global,this.dataGovernance){case l.DataGovernance.EuOnly:this.baseUrl="https://cdn-eu.configcat.com";break;default:this.baseUrl="https://cdn-global.configcat.com";break}var f=(c=o==null?void 0:o())!==null&&c!==void 0?c:new Ze;this.hooks=new et(f),this.readyPromise=new Promise(function(h){return a.hooks.once("clientReady",h)});var g,v;if(n){if(g=n.logger,v=n.cache,n.requestTimeoutMs){if(n.requestTimeoutMs<0)throw new Error("Invalid 'requestTimeoutMs' value");this.requestTimeoutMs=n.requestTimeoutMs}n.baseUrl&&(this.baseUrl=n.baseUrl,this.baseUrlOverriden=!0),n.proxy&&(this.proxy=n.proxy),n.flagOverrides&&(this.flagOverrides=n.flagOverrides),n.defaultUser&&(this.defaultUser=n.defaultUser),n.offline&&(this.offline=n.offline),(u=n.setupHooks)===null||u===void 0||u.call(n,this.hooks)}this.logger=new Xe(g??new me,this.hooks),this.cache=v?new pe(v,this.logger):i?i(this):new $e}return t.prototype.getUrl=function(){return this.baseUrl+"/configuration-files/"+this.apiKey+"/"+t.configFileName+"?sdk="+this.clientVersion},t.prototype.getCacheKey=function(){return ee(this.apiKey+"_"+t.configFileName+"_"+k.serializationFormatVersion)},t.configFileName="config_v5.json",t}(),Ue=function(t){H(e,t);function e(r,n,i,o,a,s){var c=t.call(this,r,n+"/a-"+i,o,a,s)||this;c.pollIntervalSeconds=60,c.maxInitWaitTimeSeconds=5,o&&(o.pollIntervalSeconds!==void 0&&o.pollIntervalSeconds!==null&&(c.pollIntervalSeconds=o.pollIntervalSeconds),o.maxInitWaitTimeSeconds!==void 0&&o.maxInitWaitTimeSeconds!==null&&(c.maxInitWaitTimeSeconds=o.maxInitWaitTimeSeconds));var u=2147483;if(!(typeof c.pollIntervalSeconds=="number"&&1<=c.pollIntervalSeconds&&c.pollIntervalSeconds<=u))throw new Error("Invalid 'pollIntervalSeconds' value");if(!(typeof c.maxInitWaitTimeSeconds=="number"&&c.maxInitWaitTimeSeconds<=u))throw new Error("Invalid 'maxInitWaitTimeSeconds' value");return c}return e}(fe),Me=function(t){H(e,t);function e(r,n,i,o,a,s){return t.call(this,r,n+"/m-"+i,o,a,s)||this}return e}(fe),Ve=function(t){H(e,t);function e(r,n,i,o,a,s){var c=t.call(this,r,n+"/l-"+i,o,a,s)||this;if(c.cacheTimeToLiveSeconds=60,o&&o.cacheTimeToLiveSeconds!==void 0&&o.cacheTimeToLiveSeconds!==null&&(c.cacheTimeToLiveSeconds=o.cacheTimeToLiveSeconds),!(typeof c.cacheTimeToLiveSeconds=="number"&&1<=c.cacheTimeToLiveSeconds&&c.cacheTimeToLiveSeconds<=2147483647))throw new Error("Invalid 'cacheTimeToLiveSeconds' value");return c}return e}(fe);l.OverrideBehaviour=void 0,function(t){t[t.LocalOnly=0]="LocalOnly",t[t.LocalOverRemote=1]="LocalOverRemote",t[t.RemoteOverLocal=2]="RemoteOverLocal"}(l.OverrideBehaviour||(l.OverrideBehaviour={}));var tt=function(){function t(e){this.map={},this.map=Object.fromEntries(Object.entries(e).map(function(r){var n=r[0],i=r[1];return[n,de.fromValue(i)]}))}return t.prototype.getOverrides=function(){return Promise.resolve(this.map)},t.prototype.getOverridesSync=function(){return this.map},t}(),rt=function(){function t(e,r){this.dataSource=e,this.behaviour=r}return t}(),nt=function(t){H(e,t);function e(r,n){var i=t.call(this,r,n)||this;return i.cacheTimeToLiveMs=n.cacheTimeToLiveSeconds*1e3,t.prototype.syncUpWithCache.call(i),i}return e.prototype.getConfig=function(){return b(this,void 0,void 0,function(){function r(o,a){a===void 0&&(a=""),o.debug("LazyLoadConfigService.getConfig(): cache is empty or expired"+a+".")}var n,i;return S(this,function(o){switch(o.label){case 0:return this.options.logger.debug("LazyLoadConfigService.getConfig() called."),[4,this.options.cache.get(this.cacheKey)];case 1:return n=o.sent(),n.isExpired(this.cacheTimeToLiveMs)?this.isOffline?[3,3]:(r(this.options.logger,", calling refreshConfigCoreAsync()"),[4,this.refreshConfigCoreAsync(n)]):[3,5];case 2:return i=o.sent(),n=i[1],[3,4];case 3:r(this.options.logger),o.label=4;case 4:return[2,n];case 5:return this.options.logger.debug("LazyLoadConfigService.getConfig(): cache is valid, returning from cache."),[2,n]}})})},e.prototype.refreshConfigAsync=function(){return this.options.logger.debug("LazyLoadConfigService.refreshConfigAsync() called."),t.prototype.refreshConfigAsync.call(this)},e.prototype.getCacheState=function(r){return r.isEmpty?A.NoFlagData:r.isExpired(this.cacheTimeToLiveMs)?A.HasCachedFlagDataOnly:A.HasUpToDateFlagData},e}(ce),it=function(t){H(e,t);function e(r,n){var i=t.call(this,r,n)||this;return t.prototype.syncUpWithCache.call(i),i}return e.prototype.getCacheState=function(r){return r.isEmpty?A.NoFlagData:A.HasCachedFlagDataOnly},e.prototype.getConfig=function(){return b(this,void 0,void 0,function(){return S(this,function(r){switch(r.label){case 0:return this.options.logger.debug("ManualPollService.getConfig() called."),[4,this.options.cache.get(this.cacheKey)];case 1:return[2,r.sent()]}})})},e.prototype.refreshConfigAsync=function(){return this.options.logger.debug("ManualPollService.refreshConfigAsync() called."),t.prototype.refreshConfigAsync.call(this)},e}(ce);function ot(){typeof Object.values>"u"&&(Object.values=at),typeof Object.entries>"u"&&(Object.entries=st),typeof Object.fromEntries>"u"&&(Object.fromEntries=ut)}function at(t){for(var e=[],r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];e.push(t[i])}return e}function st(t){for(var e=[],r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];e.push([i,t[i]])}return e}function ut(t){var e,r={};if(Array.isArray(t))for(var n=0,i=t;n<i.length;n++){var o=i[n],a=o[0],s=o[1];r[a]=s}else if(typeof Symbol<"u"&&(t!=null&&t[Symbol.iterator]))for(var c=t[Symbol.iterator](),u=void 0,f=void 0;e=c.next(),u=e.value,f=e.done,!f;){var a=u[0],s=u[1];r[a]=s}else throw new TypeError("Object.fromEntries() requires a single iterable argument");return r}function lt(){var t=function(e){this.target=e};return t.prototype.deref=function(){return this.target},t.isFallback=!0,t}var ct=function(){return typeof WeakRef=="function"},je=/^[0-9]+$/,$=function(t,e){var r=je.test(t),n=je.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1},he=256,te=Number.MAX_SAFE_INTEGER||9007199254740991,X=[],y=[],m={},ft=0,L=function(t,e){var r=ft++;m[t]=r,y[r]=e,X[r]=new RegExp(e)};L("NUMERICIDENTIFIER","0|[1-9]\\d*"),L("NUMERICIDENTIFIERLOOSE","[0-9]+"),L("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),L("MAINVERSION","("+y[m.NUMERICIDENTIFIER]+")\\."+("("+y[m.NUMERICIDENTIFIER]+")\\.")+("("+y[m.NUMERICIDENTIFIER]+")")),L("MAINVERSIONLOOSE","("+y[m.NUMERICIDENTIFIERLOOSE]+")\\."+("("+y[m.NUMERICIDENTIFIERLOOSE]+")\\.")+("("+y[m.NUMERICIDENTIFIERLOOSE]+")")),L("PRERELEASEIDENTIFIER","(?:"+y[m.NUMERICIDENTIFIER]+"|"+y[m.NONNUMERICIDENTIFIER]+")"),L("PRERELEASEIDENTIFIERLOOSE","(?:"+y[m.NUMERICIDENTIFIERLOOSE]+"|"+y[m.NONNUMERICIDENTIFIER]+")"),L("PRERELEASE","(?:-("+y[m.PRERELEASEIDENTIFIER]+"(?:\\."+y[m.PRERELEASEIDENTIFIER]+")*))"),L("PRERELEASELOOSE","(?:-?("+y[m.PRERELEASEIDENTIFIERLOOSE]+"(?:\\."+y[m.PRERELEASEIDENTIFIERLOOSE]+")*))"),L("BUILDIDENTIFIER","[0-9A-Za-z-]+"),L("BUILD","(?:\\+("+y[m.BUILDIDENTIFIER]+"(?:\\."+y[m.BUILDIDENTIFIER]+")*))"),L("FULLPLAIN","v?"+y[m.MAINVERSION]+y[m.PRERELEASE]+"?"+y[m.BUILD]+"?"),L("FULL","^"+y[m.FULLPLAIN]+"$"),L("LOOSEPLAIN","[v=\\s]*"+y[m.MAINVERSIONLOOSE]+y[m.PRERELEASELOOSE]+"?"+y[m.BUILD]+"?"),L("LOOSE","^"+y[m.LOOSEPLAIN]+"$");var re=function(){function t(e,r){if((!r||typeof r!="object")&&(r={loose:!!r,includePrerelease:!1}),e instanceof t){if(e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError("Invalid Version: "+e);if(e.length>he)throw new TypeError("version is longer than "+he+" characters");this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;var n=e.trim().match(r.loose?X[m.LOOSE]:X[m.FULL]);if(!n)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>te||this.major<0)throw new TypeError("Invalid major version");if(this.minor>te||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>te||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(function(i){if(/^[0-9]+$/.test(i)){var o=+i;if(o>=0&&o<te)return o}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}return t.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},t.prototype.toString=function(){return this.version},t.prototype.compare=function(e){if(!(e instanceof t)){if(typeof e=="string"&&e===this.version)return 0;e=new t(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)},t.prototype.compareMain=function(e){return e instanceof t||(e=new t(e,this.options)),$(this.major,e.major)||$(this.minor,e.minor)||$(this.patch,e.patch)},t.prototype.comparePre=function(e){if(e instanceof t||(e=new t(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var r=0;do{var n=this.prerelease[r],i=e.prerelease[r];if(n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return $(n,i)}while(++r)},t.prototype.compareBuild=function(e){e instanceof t||(e=new t(e,this.options));var r=0;do{var n=this.build[r],i=e.build[r];if(n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return $(n,i)}while(++r)},t.prototype.inc=function(e,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r),this.inc("pre",r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r),this.inc("pre",r);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var n=this.prerelease.length;--n>=0;)typeof this.prerelease[n]=="number"&&(this.prerelease[n]++,n=-2);n===-1&&this.prerelease.push(0)}r&&(this.prerelease[0]===r?isNaN(this.prerelease[1])&&(this.prerelease=[r,0]):this.prerelease=[r,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},t}(),ht=function(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof re)return t;if(typeof t!="string"||t.length>he)return null;var r=e.loose?X[m.LOOSE]:X[m.FULL];if(!r.test(t))return null;try{return new re(t,e)}catch{return null}},z=function(t,e,r){return new re(t,r).compare(new re(e,r))},B=function(t){var e=ht(t,!1);return e?e.version:null},gt=function(t,e){return z(t,e,!0)===0},vt=function(t,e){return z(t,e,!1)===0},dt=function(t,e){return z(t,e,!1)<0},pt=function(t,e){return z(t,e,!1)<=0},mt=function(t,e){return z(t,e,!1)>0},yt=function(t,e){return z(t,e,!1)>=0},Et=function(){function t(e,r,n,i){this.custom={},this.identifier=e,this.email=r,this.country=n,this.custom=i||{}}return t}(),bt=function(){function t(e){this.logger=e}return t.prototype.evaluate=function(e,r,n,i,o){if(this.logger.debug("RolloutEvaluator.Evaluate() called."),e.type<0&&!qe(e.value))throw new TypeError(e.value===null?"Setting value is null.":e.value===void 0?"Setting value is undefined.":"Setting value '"+e.value+"' is of an unsupported type ("+typeof e.value+").");var a=new St;a.user=i,a.keyName=r,a.returnValue=n;var s;try{if(i){if(s=this.evaluateRules(e.targetingRules,i,a),s!==null||(s=this.evaluatePercentageRules(e.percentageOptions,r,i),e.percentageOptions&&e.percentageOptions.length>0&&a.opAppendLine("Evaluating % options => "+(s?"user targeted":"user not targeted")),s!==null))return a.returnValue=s.value,s}else(e.targetingRules&&e.targetingRules.length>0||e.percentageOptions&&e.percentageOptions.length>0)&&this.logger.targetingIsNotPossible(r);return s={value:e.value,variationId:e.variationId},a.returnValue=s.value,s}finally{this.logger.settingEvaluated(a)}},t.prototype.evaluateRules=function(e,r,n){if(this.logger.debug("RolloutEvaluator.EvaluateRules() called."),e&&e.length>0)for(var i=function(c){var u=e[c],f=o.getUserAttribute(r,u.comparisonAttribute),g=u.comparator,v=u.comparisonValue,h="Evaluating rule: '"+f+"' "+o.ruleToString(g)+" '"+v+"' => ";if(!f)return h+="NO MATCH (Attribute is not defined on the user object)",n.opAppendLine(h),"continue";var d={value:u.value,variationId:u.variationId,matchedTargetingRule:u};switch(g){case l.Comparator.In:for(var p=v.split(","),E=0;E<p.length;E++)if(p[E].trim()===f)return h+="MATCH",n.opAppendLine(h),{value:d};h+="no match";break;case l.Comparator.NotIn:if(!v.split(",").some(function(F){return F.trim()===f}))return h+="MATCH",n.opAppendLine(h),{value:d};h+="no match";break;case l.Comparator.Contains:if(f.indexOf(v)!==-1)return h+="MATCH",n.opAppendLine(h),{value:d};h+="no match";break;case l.Comparator.NotContains:if(f.indexOf(v)===-1)return h+="MATCH",n.opAppendLine(h),{value:d};h+="no match";break;case l.Comparator.SemVerIn:case l.Comparator.SemVerNotIn:case l.Comparator.SemVerLessThan:case l.Comparator.SemVerLessThanEqual:case l.Comparator.SemVerGreaterThan:case l.Comparator.SemVerGreaterThanEqual:if(o.evaluateSemver(f,v,g))return h+="MATCH",n.opAppendLine(h),{value:d};h+="no match";break;case l.Comparator.NumberEqual:case l.Comparator.NumberNotEqual:case l.Comparator.NumberLessThan:case l.Comparator.NumberLessThanEqual:case l.Comparator.NumberGreaterThan:case l.Comparator.NumberGreaterThanEqual:if(o.evaluateNumber(f,v,g))return h+="MATCH",n.opAppendLine(h),{value:d};h+="no match";break;case l.Comparator.SensitiveOneOf:{for(var I=v.split(","),U=ee(f),E=0;E<I.length;E++)if(I[E].trim()===U)return h+="MATCH",n.opAppendLine(h),{value:d};h+="no match";break}case l.Comparator.SensitiveNotOneOf:{var D=ee(f);if(!v.split(",").some(function(F){return F.trim()===D}))return h+="MATCH",n.opAppendLine(h),{value:d};h+="no match";break}}n.opAppendLine(h)},o=this,a=0;a<e.length;a++){var s=i(a);if(typeof s=="object")return s.value}return null},t.prototype.evaluatePercentageRules=function(e,r,n){if(this.logger.debug("RolloutEvaluator.EvaluateVariations() called."),e&&e.length>0)for(var i=r+(n.identifier===null||n.identifier===void 0?"":n.identifier),o=ee(i).substring(0,7),a=parseInt(o,16)%100,s=0,c=0;c<e.length;c++){var u=e[c];if(s+=+u.percentage,a<s)return{value:u.value,variationId:u.variationId,matchedPercentageOption:u}}return null},t.prototype.evaluateNumber=function(e,r,n){this.logger.debug("RolloutEvaluator.EvaluateNumber() called.");var i,o;if(e&&!Number.isNaN(Number.parseFloat(e.replace(",","."))))i=Number.parseFloat(e.replace(",","."));else return!1;if(r&&!Number.isNaN(Number.parseFloat(r.replace(",","."))))o=Number.parseFloat(r.replace(",","."));else return!1;switch(n){case l.Comparator.NumberEqual:return i===o;case l.Comparator.NumberNotEqual:return i!==o;case l.Comparator.NumberLessThan:return i<o;case l.Comparator.NumberLessThanEqual:return i<=o;case l.Comparator.NumberGreaterThan:return i>o;case l.Comparator.NumberGreaterThanEqual:return i>=o}return!1},t.prototype.evaluateSemver=function(e,r,n){if(this.logger.debug("RolloutEvaluator.EvaluateSemver() called."),B(e)==null||r===void 0)return!1;switch(r=r.trim(),n){case l.Comparator.SemVerIn:for(var i=r.split(","),o=!1,a=0;a<i.length;a++)if(!(!i[a]||i[a].trim()==="")){if(B(i[a].trim())==null)return!1;o||(o=gt(e,i[a].trim()))}return o;case l.Comparator.SemVerNotIn:return!r.split(",").some(function(s){return!s||s.trim()===""||(s=B(s.trim()),s==null)?!1:vt(e,s)});case l.Comparator.SemVerLessThan:return B(r)==null?!1:dt(e,r);case l.Comparator.SemVerLessThanEqual:return B(r)==null?!1:pt(e,r);case l.Comparator.SemVerGreaterThan:return B(r)==null?!1:mt(e,r);case l.Comparator.SemVerGreaterThanEqual:return B(r)==null?!1:yt(e,r)}return!1},t.prototype.getUserAttribute=function(e,r){switch(r){case"Identifier":return e.identifier;case"Email":return e.email;case"Country":return e.country;default:return(e.custom||{})[r]}},t.prototype.ruleToString=function(e){switch(e){case l.Comparator.In:return"IS ONE OF";case l.Comparator.NotIn:return"IS NOT ONE OF";case l.Comparator.Contains:return"CONTAINS";case l.Comparator.NotContains:return"DOES NOT CONTAIN";case l.Comparator.SemVerIn:return"IS ONE OF (SemVer)";case l.Comparator.SemVerNotIn:return"IS NOT ONE OF (SemVer)";case l.Comparator.SemVerLessThan:return"< (SemVer)";case l.Comparator.SemVerLessThanEqual:return"<= (SemVer)";case l.Comparator.SemVerGreaterThan:return"> (SemVer)";case l.Comparator.SemVerGreaterThanEqual:return">= (SemVer)";case l.Comparator.NumberEqual:return"= (Number)";case l.Comparator.NumberNotEqual:return"!= (Number)";case l.Comparator.NumberLessThan:return"< (Number)";case l.Comparator.NumberLessThanEqual:return"<= (Number)";case l.Comparator.NumberGreaterThan:return"> (Number)";case l.Comparator.NumberGreaterThanEqual:return">= (Number)";case l.Comparator.SensitiveOneOf:return"IS ONE OF (Sensitive)";case l.Comparator.SensitiveNotOneOf:return"IS NOT ONE OF (Sensitive)";default:return e+""}},t}(),St=function(){function t(){this.operations=""}return t.prototype.opAppendLine=function(e){this.operations+=" "+e+`
`},t.prototype.toString=function(){return"Evaluate '"+this.keyName+`'
 User : `+JSON.stringify(this.user)+`
`+this.operations+" Returning value : "+this.returnValue},t}();function He(t,e,r,n){return{key:t,value:e.value,variationId:e.variationId,fetchTime:r,user:n,isDefaultValue:!1,matchedEvaluationRule:e.matchedTargetingRule,matchedEvaluationPercentageRule:e.matchedPercentageOption}}function _(t,e,r,n,i,o){return{key:t,value:e,fetchTime:r,user:n,isDefaultValue:!0,errorMessage:i,errorException:o}}function ne(t,e,r,n,i,o,a){var s;if(!e)return s=a.configJsonIsNotPresentSingle(r,"defaultValue",n).toString(),_(r,n,M(o),i,s);var c=e[r];if(!c)return s=a.settingEvaluationFailedDueToMissingKey(r,"defaultValue",n,Ot(e)).toString(),_(r,n,M(o),i,s);var u=t.evaluate(c,r,n,i,o);if(n!=null&&typeof n!=typeof u.value)throw new TypeError(`The type of a setting must match the type of the given default value.
The setting's type was `+typeof n+", the given default value's type was "+typeof u.value+`.
Please pass a corresponding default value type.`);return He(r,u,M(o),i)}function We(t,e,r,n,i,o){var a;if(!ge(e,i,o))return[[],a];for(var s=[],c=0,u=Object.entries(e);c<u.length;c++){var f=u[c],g=f[0],v=f[1],h=void 0;try{var d=t.evaluate(v,g,null,r,n);h=He(g,d,M(n),r)}catch(p){a??(a=[]),a.push(p),h=_(g,null,M(n),r,K(p),p)}s.push(h)}return[s,a]}function ge(t,e,r){return t?!0:(e.configJsonIsNotPresent(r),!1)}function qe(t){return t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"}function M(t){return t?new Date(t.timestamp):void 0}function Ot(t){return Object.keys(t).map(function(e){return"'"+e+"'"}).join(", ")}var Ct=function(){function t(){this.instances={}}return t.prototype.getOrCreate=function(e,r){var n,i=this.instances[e.apiKey];if(i){var o=i[0];if(n=o.deref(),n)return[n,!0]}var a={};n=new ve(e,r,a);var s=ct()?WeakRef:lt();return this.instances[e.apiKey]=[new s(n),a],[n,!1]},t.prototype.remove=function(e,r){var n=this.instances[e];if(n){var i=n[0],o=n[1],a=!!i.deref();if(!a||o===r)return delete this.instances[e],a}return!1},t.prototype.clear=function(){for(var e=[],r=0,n=Object.entries(this.instances);r<n.length;r++){var i=n[r],o=i[0],a=i[1][0],s=a.deref();s&&e.push(s),delete this.instances[o]}return e},t}(),Z=new Ct,ve=function(){function t(e,r,n){var i;if(this.cacheToken=n,this.addListener=this.on,this.off=this.removeListener,!e)throw new Error("Invalid 'options' value");if(this.options=e,this.options.logger.debug("Initializing ConfigCatClient. Options: "+JSON.stringify(this.options)),!r)throw new Error("Invalid 'configCatKernel' value");if(!r.configFetcher)throw new Error("Invalid 'configCatKernel.configFetcher' value");e.defaultUser&&this.setDefaultUser(e.defaultUser),this.evaluator=new bt(e.logger),((i=e.flagOverrides)===null||i===void 0?void 0:i.behaviour)!==l.OverrideBehaviour.LocalOnly?this.configService=e instanceof Ue?new Ye(r.configFetcher,e):e instanceof Me?new it(r.configFetcher,e):e instanceof Ve?new nt(r.configFetcher,e):function(){throw new Error("Invalid 'options' value")}():this.options.hooks.emit("clientReady",A.HasLocalOverrideFlagDataOnly),this.suppressFinalize=se(this,{sdkKey:e.apiKey,cacheToken:n,configService:this.configService,logger:e.logger})}return Object.defineProperty(t,"instanceCache",{get:function(){return Z},enumerable:!1,configurable:!0}),t.get=function(e,r,n,i){if(!e)throw new Error("Invalid 'sdkKey' value");var o=r===l.PollingMode.AutoPoll?Ue:r===l.PollingMode.ManualPoll?Me:r===l.PollingMode.LazyLoad?Ve:function(){throw new Error("Invalid 'pollingMode' value")}(),a=new o(e,i.sdkType,i.sdkVersion,n,i.defaultCacheFactory,i.eventEmitterFactory),s=Z.getOrCreate(a,i),c=s[0],u=s[1];return u&&n&&a.logger.clientIsAlreadyCreated(e),c},t.finalize=function(e){var r;(r=e.logger)===null||r===void 0||r.debug("finalize() called"),e.cacheToken&&Z.remove(e.sdkKey,e.cacheToken),t.close(e.configService,e.logger)},t.close=function(e,r,n){r==null||r.debug("close() called"),n==null||n.tryDisconnect(),e==null||e.dispose()},t.prototype.dispose=function(){var e=this.options;e.logger.debug("dispose() called"),this.cacheToken&&Z.remove(e.apiKey,this.cacheToken),t.close(this.configService,e.logger,e.hooks),this.suppressFinalize()},t.disposeAll=function(){for(var e=Z.clear(),r,n=0,i=e;n<i.length;n++){var o=i[n];try{t.close(o.configService,o.options.logger,o.options.hooks),o.suppressFinalize()}catch(a){r??(r=[]),r.push(a)}}if(r)throw typeof AggregateError<"u"?new AggregateError(r):r.pop()},t.prototype.getValueAsync=function(e,r,n){return b(this,void 0,void 0,function(){var i,o,a,s,c,u;return S(this,function(f){switch(f.label){case 0:this.options.logger.debug("getValueAsync() called."),oe(e),ae(r),a=null,n??(n=this.defaultUser),f.label=1;case 1:return f.trys.push([1,3,,4]),s=void 0,[4,this.getSettingsAsync()];case 2:return u=f.sent(),s=u[0],a=u[1],o=ne(this.evaluator,s,e,r,n,a,this.options.logger),i=o.value,[3,4];case 3:return c=f.sent(),this.options.logger.settingEvaluationErrorSingle("getValueAsync",e,"defaultValue",r,c),o=_(e,r,M(a),n,K(c),c),i=r,[3,4];case 4:return this.options.hooks.emit("flagEvaluated",o),[2,i]}})})},t.prototype.getValueDetailsAsync=function(e,r,n){return b(this,void 0,void 0,function(){var i,o,a,s,c;return S(this,function(u){switch(u.label){case 0:this.options.logger.debug("getValueDetailsAsync() called."),oe(e),ae(r),o=null,n??(n=this.defaultUser),u.label=1;case 1:return u.trys.push([1,3,,4]),a=void 0,[4,this.getSettingsAsync()];case 2:return c=u.sent(),a=c[0],o=c[1],i=ne(this.evaluator,a,e,r,n,o,this.options.logger),[3,4];case 3:return s=u.sent(),this.options.logger.settingEvaluationErrorSingle("getValueDetailsAsync",e,"defaultValue",r,s),i=_(e,r,M(o),n,K(s),s),[3,4];case 4:return this.options.hooks.emit("flagEvaluated",i),[2,i]}})})},t.prototype.getAllKeysAsync=function(){return b(this,void 0,void 0,function(){var e,r,n;return S(this,function(i){switch(i.label){case 0:this.options.logger.debug("getAllKeysAsync() called."),e="empty array",i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.getSettingsAsync()];case 2:return r=i.sent()[0],ge(r,this.options.logger,e)?[2,Object.keys(r)]:[2,[]];case 3:return n=i.sent(),this.options.logger.settingEvaluationError("getAllKeysAsync",e,n),[2,[]];case 4:return[2]}})})},t.prototype.getAllValuesAsync=function(e){return b(this,void 0,void 0,function(){var r,n,i,o,a,s,c,u,f,g,v,h;return S(this,function(d){switch(d.label){case 0:this.options.logger.debug("getAllValuesAsync() called."),r="empty array",e??(e=this.defaultUser),d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.getSettingsAsync()];case 2:return a=d.sent(),s=a[0],c=a[1],h=We(this.evaluator,s,e,c,this.options.logger,r),i=h[0],o=h[1],n=i.map(function(p){return new Q(p.key,p.value)}),[3,4];case 3:return u=d.sent(),this.options.logger.settingEvaluationError("getAllValuesAsync",r,u),[2,[]];case 4:for(o!=null&&o.length&&this.options.logger.settingEvaluationError("getAllValuesAsync","evaluation result",typeof AggregateError<"u"?new AggregateError(o):o.pop()),f=0,g=i;f<g.length;f++)v=g[f],this.options.hooks.emit("flagEvaluated",v);return[2,n]}})})},t.prototype.getAllValueDetailsAsync=function(e){return b(this,void 0,void 0,function(){var r,n,i,o,a,s,c,u,f,g,v;return S(this,function(h){switch(h.label){case 0:this.options.logger.debug("getAllValueDetailsAsync() called."),r="empty array",e??(e=this.defaultUser),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.getSettingsAsync()];case 2:return o=h.sent(),a=o[0],s=o[1],v=We(this.evaluator,a,e,s,this.options.logger,r),n=v[0],i=v[1],[3,4];case 3:return c=h.sent(),this.options.logger.settingEvaluationError("getAllValueDetailsAsync",r,c),[2,[]];case 4:for(i!=null&&i.length&&this.options.logger.settingEvaluationError("getAllValueDetailsAsync","evaluation result",typeof AggregateError<"u"?new AggregateError(i):i.pop()),u=0,f=n;u<f.length;u++)g=f[u],this.options.hooks.emit("flagEvaluated",g);return[2,n]}})})},t.prototype.getKeyAndValueAsync=function(e){return b(this,void 0,void 0,function(){var r,n,i,o,a,s,c,u,v,f,g,v,h,d;return S(this,function(p){switch(p.label){case 0:this.options.logger.debug("getKeyAndValueAsync() called."),r="null",p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.getSettingsAsync()];case 2:if(n=p.sent()[0],!ge(n,this.options.logger,r))return[2,null];for(i=0,o=Object.entries(n);i<o.length;i++){if(a=o[i],s=a[0],c=a[1],e===c.variationId)return[2,new Q(s,c.value)];if(u=n[s].targetingRules,u&&u.length>0){for(v=0;v<u.length;v++)if(f=u[v],e===f.variationId)return[2,new Q(s,f.value)]}if(g=n[s].percentageOptions,g&&g.length>0){for(v=0;v<g.length;v++)if(h=g[v],e===h.variationId)return[2,new Q(s,h.value)]}}return this.options.logger.settingForVariationIdIsNotPresent(e),[3,4];case 3:return d=p.sent(),this.options.logger.settingEvaluationError("getKeyAndValueAsync",r,d),[3,4];case 4:return[2,null]}})})},t.prototype.forceRefreshAsync=function(){return b(this,void 0,void 0,function(){var e,r;return S(this,function(n){switch(n.label){case 0:if(this.options.logger.debug("forceRefreshAsync() called."),!this.configService)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.configService.refreshConfigAsync()];case 2:return e=n.sent()[0],[2,e];case 3:return r=n.sent(),this.options.logger.forceRefreshError("forceRefreshAsync",r),[2,J.failure(K(r),r)];case 4:return[3,6];case 5:return[2,J.failure("Client is configured to use the LocalOnly override behavior, which prevents making HTTP requests.")];case 6:return[2]}})})},t.prototype.setDefaultUser=function(e){this.defaultUser=e},t.prototype.clearDefaultUser=function(){this.defaultUser=void 0},Object.defineProperty(t.prototype,"isOffline",{get:function(){var e,r;return(r=(e=this.configService)===null||e===void 0?void 0:e.isOffline)!==null&&r!==void 0?r:!0},enumerable:!1,configurable:!0}),t.prototype.setOnline=function(){this.configService?this.configService.setOnline():this.options.logger.configServiceMethodHasNoEffectDueToOverrideBehavior(l.OverrideBehaviour[l.OverrideBehaviour.LocalOnly],"setOnline")},t.prototype.setOffline=function(){var e;(e=this.configService)===null||e===void 0||e.setOffline()},t.prototype.waitForReady=function(){return this.options.readyPromise},t.prototype.snapshot=function(){var e,r,n,i=this,o,a=function(){var g=i.options.cache.getInMemory(),v=g.isEmpty?null:g.config.settings;return[v,g]},s,c,u=(o=this.options)===null||o===void 0?void 0:o.flagOverrides;if(u){var f=u.dataSource.getOverridesSync();switch(u.behaviour){case l.OverrideBehaviour.LocalOnly:return new ie(f,null,this);case l.OverrideBehaviour.LocalOverRemote:return e=a(),s=e[0],c=e[1],new ie(P(P({},s??{}),f),c,this);case l.OverrideBehaviour.RemoteOverLocal:return r=a(),s=r[0],c=r[1],new ie(P(P({},f),s??{}),c,this)}}return n=a(),s=n[0],c=n[1],new ie(s,c,this)},t.prototype.getSettingsAsync=function(){var e;return b(this,void 0,void 0,function(){var r,n,i,o,a,s,c,u,f=this;return S(this,function(g){switch(g.label){case 0:return this.options.logger.debug("getSettingsAsync() called."),r=function(){return b(f,void 0,void 0,function(){var v,h;return S(this,function(d){switch(d.label){case 0:return[4,this.configService.getConfig()];case 1:return v=d.sent(),h=v.isEmpty?null:v.config.settings,[2,[h,v]]}})})},n=(e=this.options)===null||e===void 0?void 0:e.flagOverrides,n?(i=void 0,o=void 0,[4,n.dataSource.getOverrides()]):[3,7];case 1:switch(a=g.sent(),s=n.behaviour,s){case l.OverrideBehaviour.LocalOnly:return[3,2];case l.OverrideBehaviour.LocalOverRemote:return[3,3];case l.OverrideBehaviour.RemoteOverLocal:return[3,5]}return[3,7];case 2:return[2,[a,null]];case 3:return[4,r()];case 4:return c=g.sent(),i=c[0],o=c[1],[2,[P(P({},i??{}),a),o]];case 5:return[4,r()];case 6:return u=g.sent(),i=u[0],o=u[1],[2,[P(P({},a),i??{}),o]];case 7:return[4,r()];case 8:return[2,g.sent()]}})})},t.prototype.on=function(e,r){return this.options.hooks.on(e,r),this},t.prototype.once=function(e,r){return this.options.hooks.once(e,r),this},t.prototype.removeListener=function(e,r){return this.options.hooks.removeListener(e,r),this},t.prototype.removeAllListeners=function(e){return this.options.hooks.removeAllListeners(e),this},t.prototype.listeners=function(e){return this.options.hooks.listeners(e)},t.prototype.listenerCount=function(e){return this.options.hooks.listenerCount(e)},t.prototype.eventNames=function(){return this.options.hooks.eventNames()},t}(),ie=function(){function t(e,r,n){this.mergedSettings=e,this.remoteConfig=r,this.defaultUser=n.defaultUser,this.evaluator=n.evaluator,this.options=n.options,this.cacheState=r?n.configService.getCacheState(r):A.HasLocalOverrideFlagDataOnly}return Object.defineProperty(t.prototype,"fetchedConfig",{get:function(){var e=this.remoteConfig;return e&&!e.isEmpty?e.config:null},enumerable:!1,configurable:!0}),t.prototype.getAllKeys=function(){return this.mergedSettings?Object.keys(this.mergedSettings):[]},t.prototype.getValue=function(e,r,n){this.options.logger.debug("Snapshot.getValue() called."),oe(e),ae(r);var i,o;n??(n=this.defaultUser);try{o=ne(this.evaluator,this.mergedSettings,e,r,n,this.remoteConfig,this.options.logger),i=o.value}catch(a){this.options.logger.settingEvaluationErrorSingle("Snapshot.getValue",e,"defaultValue",r,a),o=_(e,r,M(this.remoteConfig),n,K(a),a),i=r}return this.options.hooks.emit("flagEvaluated",o),i},t.prototype.getValueDetails=function(e,r,n){this.options.logger.debug("Snapshot.getValueDetails() called."),oe(e),ae(r);var i;n??(n=this.defaultUser);try{i=ne(this.evaluator,this.mergedSettings,e,r,n,this.remoteConfig,this.options.logger)}catch(o){this.options.logger.settingEvaluationErrorSingle("Snapshot.getValueDetails",e,"defaultValue",r,o),i=_(e,r,M(this.remoteConfig),n,K(o),o)}return this.options.hooks.emit("flagEvaluated",i),i},t}(),Q=function(){function t(e,r){this.settingKey=e,this.settingValue=r}return t}();function oe(t){if(!t)throw new Error("Invalid 'key' value")}function ae(t){if(!qe(t))throw new TypeError("The default value must be boolean, number, string, null or undefined.")}var se=function(t,e){if(typeof FinalizationRegistry<"u"){var r=new FinalizationRegistry(function(n){return ve.finalize(n)});se=function(n,i){var o={};return r.register(n,i,o),function(){return r.unregister(o)}}}else se=function(){return function(){}};return se(t,e)};ot();function Tt(t,e,r,n){return ve.get(t,e,r,n)}function At(t){return new me(t)}const Lt={key:0},wt={key:1},It={key:2},Nt=O.defineComponent({__name:"FeatureWrapper",props:{featureKey:{},userObject:{}},emits:["flagValueChanged"],setup(t,{emit:e}){const r=t,n=O.ref(null),i=O.inject("configCatClient"),o=()=>{const a=i==null?void 0:i.snapshot(),s=a==null?void 0:a.getValue(r.featureKey,!1,r.userObject);n.value!==s&&(n.value=s,e("flagValueChanged",s))};return O.onBeforeMount(()=>{const a=i==null?void 0:i.snapshot(),s=a==null?void 0:a.cacheState;s==A.HasUpToDateFlagData||s==A.HasLocalOverrideFlagDataOnly?(n.value=a==null?void 0:a.getValue(r.featureKey,!1,r.userObject),i==null||i.on("configChanged",o)):i==null||i.getValueAsync(r.featureKey,!1,r.userObject).then(c=>{const u=o;u&&(n.value=c,i.on("configChanged",u))})}),O.onUnmounted(()=>{i==null||i.off("configChanged",o)}),(a,s)=>(O.openBlock(),O.createElementBlock("div",null,[n.value===!0?(O.openBlock(),O.createElementBlock("div",Lt,[O.renderSlot(a.$slots,"default")])):n.value===!1?(O.openBlock(),O.createElementBlock("div",wt,[O.renderSlot(a.$slots,"else")])):(O.openBlock(),O.createElementBlock("div",It,[O.renderSlot(a.$slots,"loading")]))]))}});class Rt{handleStateChange(e,r,n){try{if(e.readyState===4){const{status:i,statusText:o}=e;if(i===200){const a=e.getResponseHeader("ETag")??void 0;r({statusCode:i,reasonPhrase:o,eTag:a,body:e.responseText})}else i&&r({statusCode:i,reasonPhrase:o})}}catch(i){n(i)}}fetchLogic(e,r){return new Promise((n,i)=>{try{e.logger.debug("HttpConfigFetcher.fetchLogic() called.");const o=new XMLHttpRequest;o.onreadystatechange=()=>this.handleStateChange(o,n,i),o.ontimeout=()=>i(new x("timeout",e.requestTimeoutMs)),o.onabort=()=>i(new x("abort")),o.onerror=()=>i(new x("failure")),o.open("GET",e.getUrl(),!0),o.timeout=e.requestTimeoutMs,o.send(null)}catch(o){i(o)}})}}class Dt{set(e,r){try{localStorage.setItem(e,btoa(r))}catch{}}get(e){try{const r=localStorage.getItem(e);if(r)return atob(r)}catch{}}}const Ft="CONFIGCAT_SDK_VERSION",Pt={install:(t,e)=>{const{sdkKey:r,pollingMode:n,clientOptions:i}=e,o={sdkType:"ConfigCat-Vue",sdkVersion:Ft,configFetcher:new Rt,defaultCacheFactory:c=>new pe(new Dt,c.logger)},a=Tt(r,n??l.PollingMode.AutoPoll,i,o);t.provide("configCatClient",a);const s=t.unmount;t.unmount=function(){s.apply(arguments),a.dispose()}}};function kt(t,e){return new rt(new tt(t),e)}l.ClientReadyState=xe,l.ConfigCatPlugin=Pt,l.FeatureWrapper=Nt,l.FormattableLogMessage=C,l.RefreshResult=J,l.SettingKeyValue=Q,l.User=Et,l.createConsoleLogger=At,l.createFlagOverridesFromMap=kt,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
